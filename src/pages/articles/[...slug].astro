---
import { marked } from "marked"

import "../../styles/custom.css"

// LAYOUTS
import Layout from "../../layouts/Layout.astro"
import Container from "../../layouts/Container.astro"

// CUSTOM STYLES
import "../../styles/custom.css"

// COMPONENTS
import Header from "../../components/Header"
import Footer from "../../components/Footer.astro"
import ContactUs from "../../components/home/ContactUs.astro"
import ArticleInfo from "../../components/articles/ArticleInfo.astro"
import RecentArticles from "../../components/articles/RecentArticles.astro"

const { slug } = Astro.params

// NETWORK CALL
const data = await fetch( "https://staging.api.urbaninsight.blupp.co/articles" )
const data_json = await data.json()

if( data.status !== 200 ){

    return Astro.redirect("/")

}

const articles = data_json.data

// FIND THE SLUG
let article = articles.filter( ( res ) => res.slug === slug )
article = article[0]

const content = article.md

const html = marked.parse( content )
---
<Layout
    title=""
    description=""
    image=""
>
    <Header />
    <section class="container max-w-4xl mx-auto">
    <ArticleInfo
        date="February, 2023"
        title={ articles.title }
        src="/images/Broad.jpg"
        alt=""
        name="Josh Skelly"
        designation="Chief Executive Officer"
    />
    <section set:html={ html } class="markdown pt-20 pb-28 font-open_sans" />
    </section>
    <Container>
        <RecentArticles />
    </Container>
    <ContactUs />
    <Footer />
</Layout>
